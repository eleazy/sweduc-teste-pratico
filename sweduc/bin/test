#!/bin/bash

docker compose exec \
    -T db-testes mysql -h db-testes -uroot -pteste teste -e "DROP DATABASE IF EXISTS teste;CREATE DATABASE teste" > /dev/null;

docker compose exec \
    -T db-testes mysql -h db-testes -uroot -pteste teste < database/tenancy/base.sql  > /dev/null;

docker compose exec \
  --env="DB_HOST=db-testes" \
  --env="DB_DATABASE=teste" \
  --env="DB_USER=teste" \
  --env="DB_PASSWORD=teste" \
  -T app vendor/bin/phinx migrate --quiet;

docker compose exec --env="XDEBUG_MODE=develop,debug" app vendor/bin/pest $*;
